From 80fdb9276f05a50abee9cb800a8d4d5335e54fa9 Mon Sep 17 00:00:00 2001
From: Ammad Rehmat <ammad.rehmat@connectus.ai>
Date: Fri, 18 Jun 2021 11:16:44 -0400
Subject: [PATCH] Wifi-2538 : clients dropped on RRM rebalance

Signed-off-by: Ammad Rehmat <ammad.rehmat@connectus.ai>
---
 package/system/procd/files/reload_config | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/package/system/procd/files/reload_config b/package/system/procd/files/reload_config
index 8d1cdb1378..458e1c5d94 100644
--- a/package/system/procd/files/reload_config
+++ b/package/system/procd/files/reload_config
@@ -5,10 +5,15 @@ for config in /etc/config/*; do
 	file=${config##*/}
 	uci show "${file##*/}" > /var/run/config.check/$file
 done
+FILE=/tmp/wireless_changes.txt
 MD5FILE=/var/run/config.md5
 [ -f $MD5FILE ] && {
-	for c in `md5sum -c $MD5FILE 2>/dev/null| grep FAILED | cut -d: -f1`; do
-		ubus call service event "{ \"type\": \"config.change\", \"data\": { \"package\": \"$(basename $c)\" }}"
+        for c in `md5sum -c $MD5FILE 2>/dev/null| grep FAILED | cut -d: -f1`; do
+		if [ -f "$FILE" ] && [ "$(basename $c)" = "wireless" ];then
+			wlan_ap_rrm_rebalance.sh
+		else
+			ubus call service event "{ \"type\": \"config.change\", \"data\": { \"package\": \"$(basename $c)\" }}"
+		fi
 	done
 }
 md5sum /var/run/config.check/* > $MD5FILE
-- 
2.17.1

